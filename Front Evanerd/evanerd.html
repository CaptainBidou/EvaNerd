<meta charset="utf-8">
<link rel="stylesheet" href="Bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="Bootstrap/css/bootstrap.css">
<link href="Jquery/jquery-ui.min.css" rel="stylesheet">
<link rel="stylesheet" href="biblio_composants.css">
<script src="Bootstrap/js/bootstrap.min.js"> </script>
<script src="Jquery/jquery-3.6.2.min.js"></script>
<script src="Jquery/jquery-ui.min.js"></script>
<script src="biblio_composants.js"></script>
<script src="AJAX.js"></script>


<script>


$(document).ready(function(){
    ConnexionAuto(); // pour afficher la connexion
    //AfficherAccueil();
});



// FONCTIONS A MODIF POUR LE AJAX


function AfficherAccueil(){
    
    $("#page").html("");
    ListPosts(authcode);
}

function AfficherProfile(context){
    $("#page").html("");
    $uid = $(context).data("id-profile");
    console.log(context);

    ListUserRoles($uid)
    ListUserInstruments($uid);
    // TODO : Lister activité utilisateur
    
}

function RolesMenu(context){
    $uid = $(context).data("id-profile");
    console.log(context);
    ListerRoles();
}

function AfficherMessagerie(){
    $("#page").html("");
    ListConv(authcode);
}

function EpinglerUnPost($postID) { 
    console.log("epingle");
    UpdateEpinglePost($postID,authcode);
}


function DesEpinglerUnPost($postID){
    console.log("desepingle");
    UpdateEpinglePost($postID,authcode);
}

function EpinglerUnMessage($mid){
    EpinglerMsgConv($mid, currentGroup, authcode);

}

function DesEpinglerUnMessage($mid){
    EpinglerUnMessage($mid);
}

function AfficherAppel(){
    $("#page").html("");
    ListCalendarsEvents(authcode, "intra");
    /* var appel={"titre":"Répétition tutti","date":"01/12/2019","commentaire":"Répétitions au capitole à 18h c'est très important de venir","sex":"0"};
    JCreerAppel(appel);
    JCreerAppel(appel);
    JCreerAppel(appel);
    JCreerAppel(appel);
    JCreerAppel(appel);
    JCreerAppel(appel);
    JCreerAppel(appel);
    JCreerAppel(appel); */
}

function AfficherCalendrier(){
    $("#page").html("");
    //ici obtenir la réponse de la requête 
    ListCalendarsEvents(authcode, "extra");

}

function CommentairesPosts($id){
    $id = $($id).attr("id_post");
    currentComm = $id;
    ListPostMessages($id,authcode);
}

function JEnvoyerCommentaire($commContent){
    console.log($commContent.value);
    $curText = $commContent.value;
    $curComm = currentComm;
    addComments($curText,$curComm,authcode);
}

function AfficherCreer(){
    //ici obtenir la réponse de la requête
    JCreerDropUpCreer();   
}

function Connexion(){
    var tel=$("#tel").val();
    var mdp=$("#pwd").val();
    auth(tel,mdp);
}


function JRecupMessages(context){
    if($(context.target).attr("type")=="convp")
        return;
    var id=$(context.target).attr("type_id");
    //connexion à un groupe 
    console.log(id);
    var nomgroupe = $(context.target).text();
    console.log(nomgroupe);
    currentGroup = id;
    $("#page").html("");
    ListMsgConv(id,nomgroupe,user,authcode,"NORMAL");

    let refresh = setInterval(function() {
        if($("#DivMessage").attr("class")!="Message")
            clearTimeout(refresh);

        ListMsgConv(id,nomgroupe,user,authcode,'REC')


    }, 1000);
}

function JRecupId(){
    //var aid = 1;
    //ListCalendarsEvents(authcode,aid);
    //ListCallMembers(authcode,aid,eid);
}

function EnvoyerMessage(groupId,message,rep){
    console.log(message);
    $informations={"content":message,
                    "answerTo":rep,};
                    
    AddMsgConv(groupId, $informations,authcode);
}

function LikerPost(idPost){
    setLikePost(idPost,authcode);
}

function CreerEvent(context){
    console.log(context);
    CreateEventCalendars(1, authcode);
}

function AjouterUtilisateur(context){
    console.log(context);
    // TODO : Trouver l'utilisateur dans le champ à ajouter
    // Puis renvoyer son uid
    //AddUserConv(currentGroup,);
}


function ConnexionAuto(){
    
   
     authcode = localStorage.getItem("authToken");
     user = parseInt(localStorage.getItem("user"));
    member = localStorage.getItem("member") == "true" ? true : false;
     pdp = localStorage.getItem("pdp");
     admin = localStorage.getItem("admin");
     console.log("connexion auto");
    console.log(user);
    console.log(admin);
    console.log(pdp);
    console.log(member);
    // var tel = localStorage.getItem("tel");
     //var passwd = localStorage.getItem("passwd");

     //return JCreerConnexion();
    if(authcode!=null && user!=null && member!=null && pdp!=null && admin!=null)
    {

     JcreerHeader({"photo" : pdp,"id" : user,"member" : !member,"admin" : admin});
        AfficherAccueil();
        JcreerFooter({"membre" : member});
    }
    else{

        /*if(tel!=null && passwd!=null){
            auth(tel,passwd);
        }
        else*/
        JCreerConnexion();
        

    }
  
}

function EnvoyerJustif(context){
    console.log(context);
    $eid = 3;
    PostEventJustif($eid, authcode);
}


</script>



<body>
    <span id="header"></span>
    <div id="page"></div>
    <span id="footer"></span>
</body>

